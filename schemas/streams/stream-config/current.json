{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schema.yext.com/config/streams/stream-config",
  "$version": "1",
  "type": "object",
  "title": "Stream Configuration",
  "properties": {
    "$id": {
      "type": "string",
      "minLength": 1,
      "maxLength": 64
    },
    "$schema": {
      "const": "https://schema.yext.com/config/streams/stream-config/v1"
    },
    "includeSubAccounts": {
      "type": "boolean",
      "description": "Indicates whether data from sub-accounts should also be streamed."
    },
    "source": {
      "type": "string",
      "enum": [
        "knowledgeGraph",
        "reviews",
        "reviewsAgg"
      ],
      "description": "The source of data to stream."
    },
    "destination": {
      "type": "string",
      "enum": [
        "pages",
        "answers",
        "streamsapi"
      ],
      "description": "The service to which the stream output data will be sent. It defaults to streamsapi if not provided."
    },
    "fields": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "The subset of fields and projections from the source data that should be streamed."
    },
    "filter": {
      "anyOf": [
        {
          "$ref": "#/definitions/filters/kg"
        },
        {
          "$ref": "#/definitions/filters/publishers"
        }
      ]
    },
    "localization": {
      "type": "object",
      "properties": {
        "locales": {
          "type": "array",
          "description": "The list of additional locales in which to produce documents.",
          "items": {
            "type": "string",
            "description": "Valid BCP-47 locale identifiers."
          }
        },
        "fallback": {
          "type": "object",
          "description": "A mapping of locales to other locales to use when data in that exact locale is unavailable.",
          "additionalProperties": {
            "type": "array",
            "description": "The ordered list of fallback locales.",
            "items": {
              "type": "string",
              "description": "Valid BCP-47 locale identifiers."
            }
          }
        }
      },
      "additionalProperties": false
    },
    "transform": {
      "type": "object",
      "properties": {
        "jsonpatch": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "A series of JSON Patch transforms to apply on the document."
        }
      },
      "description": "The transforms that need to be applied to documents before they are produced."
    }
  },
  "additionalProperties": false,
  "required": [
    "$id",
    "$schema",
    "source"
  ],
  "definitions": {
    "filters": {
      "kg": {
        "type": "object",
        "properties": {
          "entityTypes": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Entity type IDs to allow."
          },
          "savedFilterIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of the saved filters to apply on entities."
          }
        },
        "description": "Filter configuration for knowledgeGraph.",
        "additionalProperties": false
      },
      "publishers": {
        "type": "object",
        "properties": {
          "publishers": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Publisher IDs to allow."
          }
        },
        "additionalProperties": false
      }
    }
  }
}