{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schema.yext.com/config/analytics/conversion-action",
  "$version": "2.1",
  "type": "object",
  "title": "Conversion Action",
  "description": "Configures a Conversion Action.",
  "properties": {
    "$id": {
      "type": "string",
      "description": "The unique identifier for the Conversion Action resource."
    },
    "$schema": {
      "const": "https://schema.yext.com/config/analytics/conversion-action/v2"
    },
    "conversionName": {
      "type": "string",
      "description": "The human-readable name of the Conversion."
    },
    "conversionType": {
      "type": "string",
      "description": "The type of event that the Conversion represents.",
      "enum": [
        "PURCHASE",
        "LEAD",
        "PAGE_VIEW",
        "SIGN_UP",
        "OTHER",
        "COST_SAVING_CUSTOMER_SUPPORT",
        "COST_SAVING_OTHER"
      ]
    },
    "conversionValueType": {
      "type": "string",
      "description": "The way a value is applied to the Conversion, e.g. the same value for each Conversion, or no value used. The DIFFERENT value is only valid without defined \u0027clickTriggers\u0027.",
      "enum": [
        "SAME",
        "NONE",
        "DIFFERENT"
      ]
    },
    "conversionValueAmount": {
      "type": "number",
      "description": "The value of the the Conversion, set to the currency of the primary country associated with the Yext account. If there is no associated value, set to 0."
    },
    "conversionTerm": {
      "type": "object",
      "description": "Include all Conversions within the specified time frame. Enter just startDate to include only Conversions on or after this date. Enter just endDate to include only Conversions before this date. Enter both a startDate and endDate to include only Conversions between these dates. If no conversionTerm is provided, defaults startDate to the current UTC date.",
      "minProperties": 1,
      "additionalProperties": false,
      "properties": {
        "startDate": {
          "type": "string",
          "description": "The inclusive start date of the Conversion term, in `YYYY-mm-dd` format",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "The exclusive end date of the Conversion term, in `YYYY-mm-dd` format",
          "format": "date"
        }
      }
    },
    "conversionTrigger": {
      "oneOf": [
        {
          "type": "object",
          "description": "Click-based Conversion Triggers let you automatically treat certain clicks as Conversions. For example, you can say that any Driving Direction click should be counted as a Conversion. Click-based Conversion Triggers do not require the use of JavaScript tags and work with all Yext products.",
          "properties": {
            "clickTriggers": {
              "type": "array",
              "description": "Defines which types of clicks are counted as a Conversion.",
              "items": {
                "type": "object",
                "properties": {
                  "clickType": {
                    "type": "string",
                    "description": "The type of click that should be counted as a Conversion.",
                    "enum": [
                      "CALL",
                      "DETAIL",
                      "DRIVING_DIRECTIONS",
                      "FEATURED_MESSAGE",
                      "UBER_LINK",
                      "WEB",
                      "OTHER_CLICK_TYPE",
                      "ALL_CLICK_TYPES",
                      "CALL_TO_ACTION",
                      "ORDER_NOW",
                      "TITLE",
                      "ADD_TO_CART",
                      "APPLY_NOW",
                      "THUMBS_UP",
                      "ROW_EXPAND",
                      "EMAIL",
                      "BOOK_APPOINTMENT",
                      "RSVP"
                    ]
                  },
                  "media": {
                    "type": "array",
                    "description": "The media source(s) of clicks to consider when counting Conversions.",
                    "items": {
                      "oneOf": [
                        {
                          "type": "object",
                          "description": "The general Yext product type to source clicks from when counting Conversions.",
                          "properties": {
                            "mediumType": {
                              "type": "string",
                              "enum": [
                                "ALL_LISTINGS_PUBLISHERS",
                                "ALL_ANSWERS_EXPERIENCES",
                                "ALL_SEARCH_ENGINES",
                                "ALL_PAGES_LOCATOR_OR_DIRECTORY",
                                "ALL_FIRST_PARTY_SITES",
                                "ALL_PAGES_LANDING_PAGE_SETS",
                                "ALL_REFERRAL_SITES",
                                "ALL_WIDGETS",
                                "ALL_MEDIUM_TYPES"
                              ]
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "description": "The specific Answers configuration to source clicks from when counting Conversions.",
                          "properties": {
                            "answersConfig": {
                              "type": "string",
                              "format": "answers/answers-config"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    },
                    "minItems": 1,
                    "uniqueItems": true
                  },
                  "entityFilter": {
                    "type": "object",
                    "description": "The entities whose clicks should be counted as Conversions.",
                    "minProperties": 1,
                    "additionalProperties": false,
                    "properties": {
                      "entityTypeIn": {
                        "type": "array",
                        "minItems": 1,
                        "description": "An array of \u0027km/entity-type\u0027 resource identifiers to filter Conversions by.",
                        "items": {
                          "type": "string",
                          "format": "km/entity-type"
                        }
                      },
                      "entityIn": {
                        "type": "array",
                        "minItems": 1,
                        "description": "An array of \u0027km/entity\u0027 resource identifiers to filter Conversions by.",
                        "items": {
                          "type": "string",
                          "format": "km/entity"
                        }
                      },
                      "entityLabelIn": {
                        "type": "array",
                        "minItems": 1,
                        "description": "An array of \u0027km/entity-label\u0027 resource identifiers to filter Conversions by.",
                        "items": {
                          "type": "string",
                          "format": "km/entity-label"
                        }
                      },
                      "entityFolderIn": {
                        "type": "array",
                        "minItems": 1,
                        "description": "An array of \u0027km/entity-folder\u0027 resource identifiers to filter Conversions by.",
                        "items": {
                          "type": "string",
                          "format": "km/entity-folder"
                        }
                      }
                    }
                  }
                },
                "additionalProperties": false,
                "required": [
                  "clickType",
                  "media"
                ]
              },
              "minItems": 1,
              "uniqueItems": true
            },
            "completionRate": {
              "type": "number",
              "description": "Specifies the percentage of events that should count as Conversions.",
              "minimum": 1,
              "maximum": 100
            }
          },
          "additionalProperties": false,
          "required": [
            "clickTriggers",
            "completionRate"
          ]
        },
        {
          "type": "object",
          "description": "Tag Conversion Triggers let you control where the conversion is triggered when you install a conversion tracking tag on the page where the conversion occurs. After creating the conversion action, the conversion tracking tag and instructions to install can be found on the Conversion Tracking Setup page.",
          "properties": {
            "countType": {
              "type": "string",
              "description": "Specifies how many conversions to count per click or interaction.",
              "enum": [
                "EVERY",
                "ONE"
              ]
            },
            "conversionWindow": {
              "type": "number",
              "description": "Specifies the maximum number of days after a page interaction that a conversion will be counted.",
              "minimum": 1,
              "maximum": 90
            },
            "attributionModel": {
              "type": "string",
              "description": "Determines how much credit each interaction gets for a conversion.",
              "enum": [
                "LINEAR",
                "LAST_CLICK",
                "FIRST_CLICK"
              ]
            }
          },
          "additionalProperties": false,
          "required": [
            "countType",
            "conversionWindow",
            "attributionModel"
          ]
        }
      ]
    },
    "enabled": {
      "type": "boolean",
      "description": "Whether or not the Conversion resource should be considered active. Conversions will not be counted for disabled Conversion resources."
    }
  },
  "additionalProperties": false,
  "required": [
    "$id",
    "$schema",
    "conversionName",
    "conversionType",
    "conversionValueType",
    "conversionValueAmount",
    "conversionTrigger",
    "enabled"
  ]
}